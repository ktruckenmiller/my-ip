---
- hosts: localhost
  gather_facts: false
  vars:
    vpc: vpc-849531e0
    region: us-west-2
    template: service.yml
    hosted_zone: clustermaestro.com

  tasks:
    - set_fact:
        name: "{{lookup('env', 'SERVICE_NAME')}}"

    - name: cloudformation
      cloudformation:
        stack_name: "{{name}}-ecs"
        state: present
        region: "{{region}}"
        template: "service.yml"
        template_parameters:
          ClusterName: "{{lookup('env', 'CLUSTER')}}"
          ServiceName: "{{ name }}"
          HostedZone: "{{hosted_zone}}"
          Environment: prod
          Priority: "{{ lookup('env', 'PRIORITY') }}"
          CertId: 619c392f-3539-4951-b2b9-89fb2dca27d9
          Version: "{{ lookup('env', 'VERSION') }}"
